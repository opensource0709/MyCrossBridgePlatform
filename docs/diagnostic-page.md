# 測試診斷頁面開發計劃

## 頁面定位
- 路徑：/diagnostic
- 用途：用戶自我診斷 + 開發者測試演算法參數
- 分為一般模式（校準流程）和進階模式（參數調整）

## 開發階段

### 第一階段：裝置檢測基礎 ✅
- [x] 列出所有攝影機、麥克風、喇叭
- [x] 攝影機即時預覽
- [x] 麥克風音量指示條
- [x] 喇叭播放測試音
完成標準：三個裝置都可以選擇並測試正常

### 第二階段：音訊視覺化 ✅
- [x] 即時波形圖（時域）
- [x] 即時頻譜圖（FFT 頻域）
- [x] 音量數值顯示（目前音量、峰值、說話狀態）
完成標準：說話時波形圖和頻譜圖有明顯變化

### 第三階段：按鈕模式翻譯測試 ✅
- [x] 按住說話、放開送出
- [x] STT 辨識結果顯示
- [x] 翻譯結果顯示
- [x] 每個步驟延遲顯示（STT / 翻譯 / 總計）
- [x] 語言方向切換（中→越 / 越→中）
- [x] 翻譯歷史記錄
- [x] TTS 語音播放（ElevenLabs）
  - 翻譯結果旁邊有喇叭按鈕
  - 歷史記錄每筆都可播放
  - 中→越播放越南女聲，越→中播放中文聲音
完成標準：按住說中文，放開後看到越南文翻譯，點喇叭可聽語音

### 第四階段：自動校準流程 ⏳
- [ ] 步驟一：靜音採樣 5 秒
- [ ] 步驟二：說話採樣
- [ ] 步驟三：驗證測試
- [ ] 自動計算並儲存參數到 localStorage
完成標準：校準後辨識率明顯提升

### 第五階段：連續模式 VAD ⏳
- [ ] 一階微分偵測起點終點
- [ ] Queue 緩衝機制
- [ ] 標準差輔助判斷
- [ ] 即時顯示 VAD 狀態
完成標準：說話自動觸發，停止說話自動送出

### 第六階段：進階參數調整 ⏳
- [ ] FFT 門檻滑桿
- [ ] 中位數視窗滑桿
- [ ] 移動平均視窗滑桿
- [ ] 閾值滑桿
- [ ] VAD 起點終點門檻滑桿
- [ ] Queue 大小滑桿
- [ ] 即時辨識率和誤觸率評分
完成標準：調整參數後即時看到效果變化

### 第七階段：網路與系統診斷 ⏳
- [ ] 網路延遲測試
- [ ] WebSocket 連線測試
- [ ] OpenAI / ElevenLabs / Deepgram API 狀態
- [ ] 後端伺服器狀態
- [ ] 一鍵診斷報告
完成標準：一鍵產生完整診斷報告

## 演算法參數說明
- FFT 門檻：過濾高頻雜訊，預設 200Hz
- 中位數視窗：消除脈衝噪音，預設 30
- 移動平均視窗：平滑化數據，預設 30
- 閾值：靜音歸零，預設 800
- VAD 起點門檻：偵測說話開始，需校準
- VAD 終點門檻：偵測說話結束，需校準
- Queue 大小：緩衝說話前的聲音，預設 10

## UI 設計原則
- 一般用戶：只看到校準按鈕和快速選擇
- 開發者：點「進階設定」才看到所有參數
- 所有參數調整後即時生效，不需要重新整理

## 遠端測試模式

### 功能描述
兩台電腦各開啟 /diagnostic 頁面，
透過測試 ID 互相連線，模擬真實台越通話情境。

### UI 設計
- 系統自動產生測試 ID（6碼英數字，例如 ABC-123）
- 輸入對方 ID 後點連線
- 連線成功後進入雙向語音翻譯測試
- 兩端都可以看到對方的參數設定和延遲數值

### 技術實作
- 使用現有的 WebSocket 建立連線
- 不需要登入，用測試 ID 作為房間號碼
- 連線後流程與正式視訊通話相同

### 完成標準
兩台電腦互連後，可以進行完整的雙向語音翻譯測試
